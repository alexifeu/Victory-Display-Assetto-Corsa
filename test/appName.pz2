import sys
import ac
import acsys
import os
import platform

# Add third_party to sys.path
if platform.architecture()[0] == "64bit":
    libdir = 'third_party/lib64'
else:
    libdir = 'third_party/lib'
sys.path.insert(0, os.path.join(os.path.dirname(__file__), libdir))
os.environ['PATH'] = os.environ['PATH'] + ";."

from third_party.sim_info import info

# Global variables
win_image = 0
app_window = 0
race_finished = False
player_won = True  # Changed to True to always show the image

def acMain(ac_version):
    global win_image, app_window

    # Create the app window
    app_window = ac.newApp("appName")
    ac.setSize(app_window, 200, 200)

    # Logging for py_log.txt
    ac.log("Hello, Assetto Corsa application world!")

    # Console message in-game (you can view it using the Home key)
    ac.console("Hello, Assetto Corsa console!")

    # Load the image
    win_image = ac.newTexture(os.path.join(os.path.dirname(__file__), "images", "win.png"))

    # Add the image using ac.glQuadTextured
    ac.addRenderCallback(app_window, render_image)

    return "appName"

def render_image(deltaT):
    global win_image, app_window, player_won

    if win_image and player_won:
        # Get the size of the app window
        window_width, window_height = ac.getSize(app_window)

        # Get the original image size
        image_width, image_height = 1392, 206  # Your image dimensions

        # Calculate the desired scaling factor (30% bigger)
        scale_factor = 1.30

        # Calculate the scaled image dimensions
        scaled_width = image_width * scale_factor
        scaled_height = image_height * scale_factor

        # Center the scaled image within the app window
        x = (window_width - scaled_width) / 2
        y = (window_height - scaled_height) / 2

        ac.glColor4f(1.0, 1.0, 1.0, 1.0)
        ac.glQuadTextured(x, y, scaled_width, scaled_height, win_image)

def acUpdate(deltaT):
    global race_finished, player_won

    if ac.getRaceCompleted():
        if ac.getCarLeaderboardPosition(0) == 1:
            player_won = True

def acShutdown():
    # Add any shutdown code here.
    return